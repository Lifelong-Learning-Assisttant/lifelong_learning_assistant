# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ & Design

**–ü—Ä–æ–µ–∫—Ç:** Lifelong Learning Assistant for Deep Learning  
**–¶–µ–ª—å:** –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ç—ã, –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö, —Ä–µ—à–µ–Ω–∏—è –ø–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ö–ª—é—á–µ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã](#1-–∫–ª—é—á–µ–≤—ã–µ-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ-–ø—Ä–∏–Ω—Ü–∏–ø—ã)
2. [Sequence diagrams - —Ç–∏–ø–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏](#2-sequence-diagrams---—Ç–∏–ø–æ–≤—ã–µ-—Å—Ü–µ–Ω–∞—Ä–∏–∏)
3. [–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ pipeline'—ã](#3-–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ-pipeline—ã)
4. [–ò–Ω–¥–µ–∫—Å–Ω—ã–π pipeline](#4-–∏–Ω–¥–µ–∫—Å–Ω—ã–π-pipeline)
5. [–°—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤](#5-—Å—Å—ã–ª–∫–∏-–Ω–∞-–∫–∞—Ä—Ç–æ—á–∫–∏-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
6. –ò–¥–µ–∏ –æ—Ç LLM –Ω–∞ –±—É–¥—É—â–µ–µ
   - [–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å](#6-–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ-–∏-–æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å)
   - [–¢–æ—á–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è](#7-—Ç–æ—á–∫–∏-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)
   - [API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã](#8-api-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã)
   - [Observability –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#9-observability-–∏-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
   - [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø–æ–ª–∏—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö](#10-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-–∏-–ø–æ–ª–∏—Ç–∏–∫–∞-–¥–∞–Ω–Ω—ã—Ö)


---

## 1. –ö–ª—é—á–µ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

> **–í–∞–∂–Ω–æ:** –î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–æ–ø–æ–ª–Ω—è–µ—Ç [`01-overview.md`](01-overview.md) –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º–∏ –¥–µ—Ç–∞–ª—è–º–∏ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ —Ä–µ—à–µ–Ω–∏—è–º–∏.

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö **–º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏** –∏ **—Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏**:
- –ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–º–µ–µ—Ç —á–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- –ù–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–ª–∞–≥–∏–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

### 1.1 –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

| –ü—Ä–∏–Ω—Ü–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ |
|---------|----------|------------|
| **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Web UI (Streamlit) | –£–ø—Ä–æ—â–µ–Ω–∏–µ UX, —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
| **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã** | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ —á–µ—Ç–∫–∏–µ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã | –ó–∞–º–µ–Ω—è–µ–º–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ |
| **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** | Orchestration (API + Agent)<br> Retrieval (VDB + ES)<br> Source Module (Obsidian, Tavily, ...)<br> Functional Modules (Quiz Engine, Interview Simulator, ...)<br> Processing (Workers)<br> Storage | —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –ª–µ–≥–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ, –ø–ª–∞–≥–∏–Ω—ã |
| **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫** | –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –∏ –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ (Elasticsearch) –ø–æ–∏—Å–∫–∞ | –¢–æ—á–Ω–æ—Å—Ç—å –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ |
| **Provenance-first** | –ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ | –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å, –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤ |

### 1.2 –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏

- **–ü–ª–∞–≥–∏–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Orchestrator** ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫–∞–∫ `run(context)` –º–æ–¥—É–ª–∏
- **–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤** ‚Äî –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö Source Module (Obsidian, Books, Telegram –∏ –¥—Ä.)
- **–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞** ‚Äî –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö Functional Modules (Quiz Engine, Interview Simulator –∏ –¥—Ä.)
- **–õ–µ–≥–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ LLM** ‚Äî –∞–¥–∞–ø—Ç–µ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –∏ –æ–±–ª–∞—á–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–º–µ–Ω—ã FAISS ‚Üí Qdrant, MinIO ‚Üí S3 –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏

---

## 2. Sequence diagrams - —Ç–∏–ø–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 2.1 –ë—ã—Å—Ç—Ä—ã–π Q&A —Å provenance

![–ë—ã—Å—Ç—Ä—ã–π Q&A —Å provenance](diagrams-src/03-architecture/quick-qa-sequence.svg)

*–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: –ë—ã—Å—Ç—Ä—ã–π Q&A —Å provenance*

### 2.2 –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–≤–∏–∑–∞ (sync + async)

![–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–≤–∏–∑–∞ (sync + async)](diagrams-src/03-architecture/quiz-generation-sequence.svg)

*–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–≤–∏–∑–∞ (sync + async)*

### 2.3 –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–∏–≥–∏

![–ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–∏–≥–∏](diagrams-src/03-architecture/book-upload-sequence.svg)

*–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–∏–≥–∏*

### 2.4 Telegram ingest (background)

![Telegram ingest (background)](diagrams-src/03-architecture/telegram-ingest-sequence.svg)

*–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: Telegram ingest (background)*

### 2.5 –í–µ–±-–ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Tavily (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç)

![–í–µ–±-–ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Tavily (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç)](diagrams-src/03-architecture/web-search-sequence.svg)

*–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: –í–µ–±-–ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Tavily (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç)*

---

## 3. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ pipeline'—ã

### 3.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------------|------------|
| **Task Queue** | RabbitMQ | –ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –∏ idempotency |
| **Worker Pool** | Celery | –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ –≤–æ—Ä–∫–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–¥–∞—á |

### 3.2 –¢–∏–ø—ã –∑–∞–¥–∞—á

#### IO-bound –∑–∞–¥–∞—á–∏
- –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ (fb2, epub, markdown)
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±-–∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ API

#### CPU-bound –∑–∞–¥–∞—á–∏
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–≤–∏–∑–æ–≤ –∏ –∫–∞—Ä—Ç–æ—á–µ–∫

### 3.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- **Visibility timeout + retries** —Å exponential backoff
- **Dead-letter queue** –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ä–∞–∑–±–æ—Ä–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∑–∞–¥–∞—á
- **Idempotent –æ–ø–µ—Ä–∞—Ü–∏–∏** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **Circuit breakers** –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤

## 4. –ò–Ω–¥–µ–∫—Å–Ω—ã–π pipeline

### 4.1 –î–µ—Ç–∞–ª—å–Ω—ã–π flow –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

![–î–µ—Ç–∞–ª—å–Ω—ã–π flow –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö](diagrams-src/03-architecture/data-processing-flow.svg)

*Flowchart: –î–µ—Ç–∞–ª—å–Ω—ã–π flow –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö*

### 4.2 –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ chunking

| –ò—Å—Ç–æ—á–Ω–∏–∫ | –†–∞–∑–º–µ—Ä chunk | Overlap | –°—Ç—Ä–∞—Ç–µ–≥–∏—è |
|----------|--------------|---------|-----------|
| **–ö–Ω–∏–≥–∏** | 1024 —Ç–æ–∫–µ–Ω–∞ | 20% | –ü–æ –≥–ª–∞–≤–∞–º/–ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞–º |
| **Obsidian** | 512 —Ç–æ–∫–µ–Ω–æ–≤ | 15% | –ü–æ –∑–∞–º–µ—Ç–∫–∞–º |
| **Telegram** | 256 —Ç–æ–∫–µ–Ω–æ–≤ | 10% | –ü–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º |
| **Web** | 768 —Ç–æ–∫–µ–Ω–æ–≤ | 25% | –ü–æ —Å–º—ã—Å–ª–æ–≤—ã–º –±–ª–æ–∫–∞–º |

### 4.3 Provenance tracking

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:
- `file_path` –∏–ª–∏ `source_url`
- `chapter` –∏–ª–∏ `thread_id`
- `offset` –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ
- `source_id` –∏ `timestamp`
- `content_hash` –¥–ª—è deduplication

## 5. –°—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ([—Å—Å—ã–ª–∫–∞](./components/index.md)).

### 5.1 Architecture Decision Records (ADR)

| –†–µ—à–µ–Ω–∏–µ | –î–æ–∫—É–º–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|---------|----------|--------|
| –í—ã–±–æ—Ä –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î (FAISS vs Qdrant) | [`04-adr/0001-vector-db-choice.md`](04-adr/0001-vector-db-choice.md) | üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |
| –í—ã–±–æ—Ä –±—Ä–æ–∫–µ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (RabbitMQ vs Redis) | [`04-adr/0002-async-broker-choice.md`](04-adr/0002-async-broker-choice.md) | üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |
| –õ–æ–∫–∞–ª—å–Ω—ã–µ vs –æ–±–ª–∞—á–Ω—ã–µ LLM | [`04-adr/0003-local-vs-cloud-llm.md`](04-adr/0003-local-vs-cloud-llm.md) | üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |

### 5.2 –î–∏–∞–≥—Ä–∞–º–º—ã –∏ —Å—Ö–µ–º—ã

| –î–∏–∞–≥—Ä–∞–º–º–∞ | –§–æ—Ä–º–∞—Ç | –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|--------|------|------------|
| **System Components** | PlantUML | [`diagrams-src/03-architecture/system-components.puml`](diagrams_src/03-architecture/system-components.puml) | üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |
| **Quick Q&A Flow** | Mermaid | [`diagrams_src/03-architecture/quick-qa-sequence.mmd`](diagrams_src/03-architecture/quick-qa-sequence.mmd) | üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |
| **Book Ingest Process** | Mermaid | [`diagrams_src/03-architecture/book-ingest-flow.mmd`](diagrams_src/03-architecture/book-ingest-flow.mmd) | üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |
| **Async Pipelines** | Mermaid | [`diagrams_src/03-architecture/async-pipelines.mmd`](diagrams_src/03-architecture/async-pipelines.mmd) | üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |

---

## 6. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

### 6.1 –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç—Ä–∞—Ç–µ–≥–∏—è | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | SLA Target |
|-----------|-----------|-------------|------------|
| **API Gateway** | –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ (load balancer) | Stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | p99 ‚â§ 100ms |
| **Orchestrator** | Stateless ‚Üí –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ | LLM latency –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å | p99 ‚â§ 500ms + LLM |
| **LLM Service** | –û—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤ + rate limiting | –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏: GPU/CPU | p99 ‚â§ 2s (–ª–æ–∫–∞–ª—å–Ω–∞—è) |
| **Vector DB** | FAISS ‚Üí Qdrant (–ø—Ä–∏ —Ä–æ—Å—Ç–µ) | –ò–Ω–¥–µ–∫—Å –≤ –ø–∞–º—è—Ç–∏ | p99 ‚â§ 100ms |
| **Elasticsearch** | Sharding + replication | Heap size –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | p99 ‚â§ 200ms |
| **Workers** | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–æ queue depth | –í—Ä–µ–º—è –∑–∞–¥–∞—á vs SLA | 95% –∑–∞–¥–∞—á ‚â§ 10 –º–∏–Ω |

### 6.2 –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

#### Graceful degradation
- **–í–Ω–µ—à–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã** ‚Üí —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- **LLM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** ‚Üí fallback –∫ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–º—É –ø–æ–∏—Å–∫—É –±–µ–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- **Vector DB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** ‚Üí —Ç–æ–ª—å–∫–æ –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫

#### Circuit breakers
- **Tavily API**: 5 –æ—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥ ‚Üí –ø–∞—É–∑–∞ 60 —Å–µ–∫
- **LLM —Å–µ—Ä–≤–∏—Å—ã**: 3 —Ç–∞–π–º–∞—É—Ç–∞ ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –º–æ–¥–µ–ª—å
- **–í–Ω–µ—à–Ω–∏–µ –ë–î**: connection timeout ‚Üí –ø–æ–≤—Ç–æ—Ä —Å exponential backoff

#### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- **PostgreSQL**: –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã + WAL –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ
- **FAISS**: –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Å–Ω–∞–ø—à–æ—Ç—ã –∏–Ω–¥–µ–∫—Å–æ–≤
- **MinIO**: —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
- **Elasticsearch**: snapshots –≤ S3/MinIO

---

## 7. –¢–æ—á–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

### 7.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö

(–Ω–∞–ø–∏—Å–∞—Ç—å)

### 7.2 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è

(–Ω–∞–ø–∏—Å–∞—Ç—å)

### 7.3 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π LLM –º–æ–¥–µ–ª–∏

(–Ω–∞–ø–∏—Å–∞—Ç—å)

## 8. API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã

### 8.1 Authentication

```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "user@example.com",
  "password": "secure_password"
}

Response 200:
{
  "access_token": "jwt_token_here",
  "token_type": "bearer",
  "expires_in": 3600
}
```

### 8.2 Q&A Endpoints

```http
# –ë—ã—Å—Ç—Ä—ã–π Q&A
POST /api/ask
Authorization: Bearer {token}
Content-Type: application/json

{
  "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ attention mechanism?",
  "sources": ["obsidian", "yandex_handbook"],
  "max_context": 5,
  "include_provenance": true
}

Response 200:
{
  "answer": "Attention mechanism - —ç—Ç–æ...",
  "sources": [
    {
      "source_id": "obsidian_note_123",
      "snippet": "Attention –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–¥–µ–ª—è–º...",
      "confidence": 0.95,
      "file_path": "/vault/notes/attention.md"
    }
  ],
  "latency_ms": 850
}

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Å–ª–æ–∂–Ω—ã–π –∑–∞–ø—Ä–æ—Å
POST /api/ask/async
Authorization: Bearer {token}
Content-Type: application/json

{
  "question": "–°—Ä–∞–≤–Ω–∏ –ø–æ–¥—Ö–æ–¥—ã –∫ fine-tuning BERT –∏ GPT",
  "require_web_verification": true,
  "sources": ["all"],
  "depth": "comprehensive"
}

Response 202:
{
  "task_id": "task_abc123",
  "estimated_duration": "2-5 minutes",
  "web_search_enabled": true
}
```

### 8.3 Quiz Management

```http
# –°–æ–∑–¥–∞–Ω–∏–µ –∫–≤–∏–∑–∞
POST /api/quiz/create
Authorization: Bearer {token}
Content-Type: application/json

{
  "chapter_id": "yandex_ml_chapter_4",
  "n_questions": 10,
  "difficulty": "intermediate",
  "question_types": ["multiple_choice", "open_ended"],
  "adaptive": true
}

Response 202:
{
  "task_id": "quiz_gen_789",
  "quiz_id": "quiz_def456",
  "status": "generating",
  "estimated_completion": "2025-11-02T15:41:00Z"
}

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–≤–∏–∑–∞
GET /api/quiz/{quiz_id}
Authorization: Bearer {token}

Response 200:
{
  "quiz_id": "quiz_def456",
  "status": "ready",
  "questions": [
    {
      "id": "q1",
      "type": "multiple_choice",
      "question": "–ß—Ç–æ –∏–∑–º–µ—Ä—è–µ—Ç precision?",
      "options": ["TP/(TP+FP)", "TP/(TP+FN)", "TP/(TP+FP+FN)"],
      "correct_answer": 0
    }
  ],
  "metadata": {
    "source_chapter": "–ú–µ—Ç—Ä–∏–∫–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏",
    "difficulty": "intermediate",
    "created_at": "2025-11-02T15:40:00Z"
  }
}
```

### 8.4 Book Upload

```http
# –ó–∞–≥—Ä—É–∑–∫–∞ –∫–Ω–∏–≥–∏
POST /api/book/upload
Authorization: Bearer {token}
Content-Type: multipart/form-data

file: [binary data]
metadata: {
  "title": "Deep Learning",
  "author": "Ian Goodfellow",
  "language": "en",
  "format": "fb2"
}

Response 202:
{
  "task_id": "book_process_xyz789",
  "file_id": "file_abc123",
  "status": "uploaded",
  "estimated_processing_time": "5-10 minutes"
}

# –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
GET /api/book/{file_id}/status
Authorization: Bearer {token}

Response 200:
{
  "file_id": "file_abc123",
  "status": "processing", # uploaded|processing|ready|error
  "progress": 65,
  "chunks_processed": 1247,
  "chunks_total": 1923,
  "current_step": "Generating embeddings",
  "eta_seconds": 180
}
```

### 8.5 Source Management

```http
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Obsidian
POST /api/obsidian/sync
Authorization: Bearer {token}
Content-Type: application/json

{
  "vault_path": "/path/to/vault",
  "incremental": true,
  "include_attachments": false
}

Response 202:
{
  "task_id": "obsidian_sync_456",
  "status": "started",
  "estimated_duration": "2-5 minutes"
}

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Telegram –∫–∞–Ω–∞–ª–∞–º–∏
GET /api/telegram/channels
Authorization: Bearer {token}

Response 200:
{
  "channels": [
    {
      "id": "@dl_weekly",
      "name": "DL Weekly",
      "last_sync": "2025-11-02T10:00:00Z",
      "messages_processed": 1247,
      "status": "active"
    }
  ]
}

POST /api/telegram/channels
Authorization: Bearer {token}
Content-Type: application/json

{
  "channel_id": "@new_research",
  "name": "New Research Papers",
  "keywords": ["transformer", "attention", "bert"],
  "min_relevance_score": 0.7
}

Response 201:
{
  "channel_id": "@new_research",
  "status": "added",
  "first_sync_scheduled": "2025-11-02T16:00:00Z"
}
```

---

## 9. Observability –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### 9.1 –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

#### API –º–µ—Ç—Ä–∏–∫–∏
- **Latency**: p50, p95, p99 –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
- **Error rate**: 4xx, 5xx –æ—à–∏–±–∫–∏ –ø–æ —Ç–∏–ø–∞–º
- **Throughput**: –∑–∞–ø—Ä–æ—Å—ã –≤ —Å–µ–∫—É–Ω–¥—É
- **Active connections**: —Ç–µ–∫—É—â–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

#### Queue –º–µ—Ç—Ä–∏–∫–∏
- **Queue depth**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏
- **Task processing time**: –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ —Ç–∏–ø–∞–º –∑–∞–¥–∞—á
- **Retry rate**: –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- **Dead letter count**: –∑–∞–¥–∞—á–∏ –≤ DLQ

#### LLM –º–µ—Ç—Ä–∏–∫–∏
- **Token usage**: —Ç–æ–∫–µ–Ω—ã –≤ –º–∏–Ω—É—Ç—É/—á–∞—Å
- **Response time**: –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –º–æ–¥–µ–ª–∏
- **Success rate**: –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **Cost per request**: –¥–ª—è –æ–±–ª–∞—á–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

#### Storage –º–µ—Ç—Ä–∏–∫–∏
- **Index size**: —Ä–∞–∑–º–µ—Ä –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞
- **Query performance**: –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ –≤ VDB/ES
- **Storage usage**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- **Index freshness**: –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–æ–≤

### 9.2 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–∞
```json
{
  "timestamp": "2025-11-02T15:36:21.439Z",
  "level": "INFO",
  "trace_id": "req_abc123_trace_xyz789",
  "span_id": "span_456",
  "component": "orchestrator",
  "event": "qa_request_processed",
  "user_id": "user_123",
  "request_id": "req_abc123",
  "duration_ms": 850,
  "sources_used": ["obsidian", "yandex_handbook"],
  "llm_model": "llama2:7b",
  "tokens_consumed": 1247,
  "response_length": 567
}
```

#### –ê–ª–µ—Ä—Ç—ã
- **High latency**: p99 > 2s –Ω–∞ Q&A —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö
- **Queue overflow**: –≥–ª—É–±–∏–Ω–∞ –æ—á–µ—Ä–µ–¥–∏ > 1000 –∑–∞–¥–∞—á
- **High error rate**: >5% –æ—à–∏–±–æ–∫ –∑–∞ 5 –º–∏–Ω—É—Ç
- **Storage issues**: –¥–∏—Å–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω > 80%
- **LLM service down**: –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å > 30 —Å–µ–∫—É–Ω–¥

### 9.3 Runbooks

#### –û—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
2. –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å DLQ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∑–∞–¥–∞—á
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—É—é –æ—á–µ—Ä–µ–¥—å

#### Vector DB –∫–æ—Ä—Ä—É–ø—Ü–∏—è
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π snapshot –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
2. –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–æ–≤
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å

#### LLM —Ç–∞–π–º–∞—É—Ç—ã
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å LLM —Å–µ—Ä–≤–∏—Å–∞
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ fallback –º–æ–¥–µ–ª—å
3. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å degraded mode (—Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏)
4. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã

---

## 10. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø–æ–ª–∏—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### 10.1 –ü—Ä–∏–Ω—Ü–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- **Zero Trust**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏**: –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º —Ä–µ—Å—É—Ä—Å–∞–º
- **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–∫–∏–¥–∞—é—Ç —Å–∏—Å—Ç–µ–º—É
- **End-to-end encryption**: —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö

### 10.2 –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

```python
# –†–æ–ª–∏ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
ROLES = {
    "user": ["read_own_data", "ask_questions", "create_quizzes"],
    "admin": ["user_permissions"] + USER_ROLES + ["system_config"],
    "service": ["read_all_data", "write_logs"]
}

# JWT —Ç–æ–∫–µ–Ω—ã —Å –∫–æ—Ä–æ—Ç–∫–∏–º –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏
ACCESS_TOKEN_EXPIRE_MINUTES = 60
REFRESH_TOKEN_EXPIRE_DAYS = 30
```

### 10.3 –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

| –£—Ä–æ–≤–µ–Ω—å | –ê–ª–≥–æ—Ä–∏—Ç–º | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ö–ª—é—á–∏ |
|---------|----------|------------|--------|
| **At-rest** | AES-256 | PostgreSQL, MinIO, FAISS | HashiCorp Vault |
| **In-transit** | TLS 1.3 | –í—Å–µ API –≤—ã–∑–æ–≤—ã | Let's Encrypt |
| **Application** | bcrypt/Argon2 | –ü–∞—Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | Salt + pepper |

### 10.4 –ü–æ–ª–∏—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

#### PII –∑–∞—â–∏—Ç–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ**: —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–∫–∞–Ω—ã –Ω–∞ PII
- **–ò–∑–±–∏—Ä–∞—Ç–µ–ª—å–Ω–æ–µ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ**: PII –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- **Retention policy**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```yaml
data_retention:
  web_snapshots: 30 days    # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  uploaded_books: 1 year    # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  telegram_messages: 90 days # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  conversation_history: 6 months # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

privacy_settings:
  share_usage_analytics: false
  allow_external_llm: false
  encrypt_local_storage: true
```

### 10.5 –ê—É–¥–∏—Ç –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ

- **–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –¥–∞–Ω–Ω—ã–º–∏** –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å trace_id
- **–î–æ—Å—Ç—É–ø –∫ PII** —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- **–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
- **–ü—Ä–∞–≤–æ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ** –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

---

*–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª–µ–Ω: 2025-11-02*  
*–í–µ—Ä—Å–∏—è: 2.0*  
*–°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é*
