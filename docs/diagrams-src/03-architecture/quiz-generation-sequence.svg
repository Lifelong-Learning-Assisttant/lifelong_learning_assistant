<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="565px" preserveAspectRatio="none" style="width:1553px;height:565px;background:#FFFFFF;" version="1.1" viewBox="0 0 1553 565" width="1553px" zoomAndPan="magnify"><title>&#1043;&#1077;&#1085;&#1077;&#1088;&#1072;&#1094;&#1080;&#1103; &#1082;&#1074;&#1080;&#1079;&#1072; (sync + async)</title><defs/><g><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="403.7021" x="576.8796" y="35.4209">&#1043;&#1077;&#1085;&#1077;&#1088;&#1072;&#1094;&#1080;&#1103; &#1082;&#1074;&#1080;&#1079;&#1072; (sync + async)</text><g><title>............</title><rect fill="#000000" fill-opacity="0.00000" height="446.8594" width="8" x="74.5498" y="82.9063"/><line style="stroke:#000000;stroke-width:1;" x1="78" x2="78" y1="82.9063" y2="529.7656"/></g><g><title>Web UI</title><rect fill="#000000" fill-opacity="0.00000" height="446.8594" width="8" x="356.417" y="82.9063"/><line style="stroke:#000000;stroke-width:1;" x1="360.3325" x2="360.3325" y1="82.9063" y2="529.7656"/></g><g><title>API Gateway</title><rect fill="#000000" fill-opacity="0.00000" height="446.8594" width="8" x="525.188" y="82.9063"/><line style="stroke:#000000;stroke-width:1;" x1="528.9663" x2="528.9663" y1="82.9063" y2="529.7656"/></g><g><title>Orchestrator</title><rect fill="#000000" fill-opacity="0.00000" height="446.8594" width="8" x="680.3687" y="82.9063"/><line style="stroke:#000000;stroke-width:1;" x1="683.9248" x2="683.9248" y1="82.9063" y2="529.7656"/></g><g><title>Retriever</title><rect fill="#000000" fill-opacity="0.00000" height="446.8594" width="8" x="828.6812" y="82.9063"/><line style="stroke:#000000;stroke-width:1;" x1="832.3096" x2="832.3096" y1="82.9063" y2="529.7656"/></g><g><title>LLM Service</title><rect fill="#000000" fill-opacity="0.00000" height="446.8594" width="8" x="946.9878" y="82.9063"/><line style="stroke:#000000;stroke-width:1;" x1="950.0527" x2="950.0527" y1="82.9063" y2="529.7656"/></g><g><title>PostgreSQL</title><rect fill="#000000" fill-opacity="0.00000" height="446.8594" width="8" x="1073.2993" y="82.9063"/><line style="stroke:#000000;stroke-width:1;" x1="1076.9229" x2="1076.9229" y1="82.9063" y2="529.7656"/></g><g><title>Task Queue</title><rect fill="#000000" fill-opacity="0.00000" height="446.8594" width="8" x="1199.1631" y="82.9063"/><line style="stroke:#000000;stroke-width:1;" x1="1202.6758" x2="1202.6758" y1="82.9063" y2="529.7656"/></g><g><title>Worker</title><rect fill="#000000" fill-opacity="0.00000" height="446.8594" width="8" x="1321.2852" y="82.9063"/><line style="stroke:#000000;stroke-width:1;" x1="1324.9648" x2="1324.9648" y1="82.9063" y2="529.7656"/></g><g class="participant participant-head" data-participant="U"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="117.0996" x="20" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="103.0996" x="27" y="71.6045">&#1055;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1100;</text></g><g class="participant participant-tail" data-participant="U"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="117.0996" x="20" y="528.7656"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="103.0996" x="27" y="548.7607">&#1055;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1100;</text></g><g class="participant participant-head" data-participant="UI"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="64.1689" x="328.3325" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="50.1689" x="335.3325" y="71.6045">Web UI</text></g><g class="participant participant-tail" data-participant="UI"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="64.1689" x="328.3325" y="528.7656"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="50.1689" x="335.3325" y="548.7607">Web UI</text></g><g class="participant participant-head" data-participant="API"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="102.4434" x="477.9663" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="88.4434" x="484.9663" y="71.6045">API Gateway</text></g><g class="participant participant-tail" data-participant="API"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="102.4434" x="477.9663" y="528.7656"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="88.4434" x="484.9663" y="548.7607">API Gateway</text></g><g class="participant participant-head" data-participant="AG"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="102.8877" x="632.9248" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="88.8877" x="639.9248" y="71.6045">Orchestrator</text></g><g class="participant participant-tail" data-participant="AG"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="102.8877" x="632.9248" y="528.7656"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="88.8877" x="639.9248" y="548.7607">Orchestrator</text></g><g class="participant participant-head" data-participant="RET"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="78.7432" x="793.3096" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="64.7432" x="800.3096" y="71.6045">Retriever</text></g><g class="participant participant-tail" data-participant="RET"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="78.7432" x="793.3096" y="528.7656"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="64.7432" x="800.3096" y="548.7607">Retriever</text></g><g class="participant participant-head" data-participant="LLM"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="97.8701" x="902.0527" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="83.8701" x="909.0527" y="71.6045">LLM Service</text></g><g class="participant participant-tail" data-participant="LLM"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="97.8701" x="902.0527" y="528.7656"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="83.8701" x="909.0527" y="548.7607">LLM Service</text></g><g class="participant participant-head" data-participant="DB"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="94.7529" x="1029.9229" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="80.7529" x="1036.9229" y="71.6045">PostgreSQL</text></g><g class="participant participant-tail" data-participant="DB"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="94.7529" x="1029.9229" y="528.7656"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="80.7529" x="1036.9229" y="548.7607">PostgreSQL</text></g><g class="participant participant-head" data-participant="MQ"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="96.9746" x="1154.6758" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="82.9746" x="1161.6758" y="71.6045">Task Queue</text></g><g class="participant participant-tail" data-participant="MQ"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="96.9746" x="1154.6758" y="528.7656"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="82.9746" x="1161.6758" y="548.7607">Task Queue</text></g><g class="participant participant-head" data-participant="Worker"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="64.6406" x="1292.9648" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="50.6406" x="1299.9648" y="71.6045">Worker</text></g><g class="participant participant-tail" data-participant="Worker"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="64.6406" x="1292.9648" y="528.7656"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="50.6406" x="1299.9648" y="548.7607">Worker</text></g><g class="message" data-participant-1="U" data-participant-2="UI"><polygon fill="#000000" points="348.417,110.0391,358.417,114.0391,348.417,118.0391,352.417,114.0391" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="78.5498" x2="354.417" y1="114.0391" y2="114.0391"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="257.8672" x="85.5498" y="108.9731">"&#1057;&#1075;&#1077;&#1085;&#1077;&#1088;&#1080;&#1088;&#1091;&#1081; 10 &#1074;&#1086;&#1087;&#1088;&#1086;&#1089;&#1086;&#1074; &#1087;&#1086; &#1075;&#1083;&#1072;&#1074;&#1077; X"</text></g><g class="message" data-participant-1="UI" data-participant-2="API"><polygon fill="#000000" points="517.188,139.1719,527.188,143.1719,517.188,147.1719,521.188,143.1719" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="360.417" x2="523.188" y1="143.1719" y2="143.1719"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="139.8452" x="367.417" y="138.106">POST /api/quiz/create</text></g><g class="message" data-participant-1="API" data-participant-2="AG"><polygon fill="#000000" points="672.3687,168.3047,682.3687,172.3047,672.3687,176.3047,676.3687,172.3047" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="529.188" x2="678.3687" y1="172.3047" y2="172.3047"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="131.1807" x="536.188" y="167.2388">create_quiz_request</text></g><g class="message" data-participant-1="AG" data-participant-2="RET"><polygon fill="#000000" points="820.6812,197.4375,830.6812,201.4375,820.6812,205.4375,824.6812,201.4375" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="684.3687" x2="826.6812" y1="201.4375" y2="201.4375"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="124.3125" x="691.3687" y="196.3716">retrieve(chapter X)</text></g><g class="message" data-participant-1="RET" data-participant-2="AG"><polygon fill="#000000" points="695.3687,226.5703,685.3687,230.5703,695.3687,234.5703,691.3687,230.5703" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="689.3687" x2="831.6812" y1="230.5703" y2="230.5703"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="66.9106" x="701.3687" y="225.5044">fragments</text></g><g class="message" data-participant-1="AG" data-participant-2="LLM"><polygon fill="#000000" points="938.9878,255.7031,948.9878,259.7031,938.9878,263.7031,942.9878,259.7031" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="684.3687" x2="944.9878" y1="259.7031" y2="259.7031"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="227.8301" x="691.3687" y="254.6372">generate_quiz(prompt+fragments)</text></g><g class="message" data-participant-1="LLM" data-participant-2="AG"><polygon fill="#000000" points="695.3687,284.8359,685.3687,288.8359,695.3687,292.8359,691.3687,288.8359" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="689.3687" x2="949.9878" y1="288.8359" y2="288.8359"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="85.1221" x="701.3687" y="283.77">quiz_payload</text></g><g class="message" data-participant-1="AG" data-participant-2="DB"><polygon fill="#000000" points="1065.2993,313.9688,1075.2993,317.9688,1065.2993,321.9688,1069.2993,317.9688" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="684.3687" x2="1071.2993" y1="317.9688" y2="317.9688"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="137.0078" x="691.3687" y="312.9028">save(quiz_metadata)</text></g><g class="message" data-participant-1="AG" data-participant-2="MQ"><polygon fill="#000000" points="1191.1631,343.1016,1201.1631,347.1016,1191.1631,351.1016,1195.1631,347.1016" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="684.3687" x2="1197.1631" y1="347.1016" y2="347.1016"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="192.2642" x="691.3687" y="342.0356">enqueue(persist_quiz_assets)</text></g><g class="message" data-participant-1="API" data-participant-2="UI"><polygon fill="#000000" points="371.417,372.2344,361.417,376.2344,371.417,380.2344,367.417,376.2344" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="365.417" x2="528.188" y1="376.2344" y2="376.2344"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="144.771" x="377.417" y="371.1685">202 {task_id, quiz_id}</text></g><path d="M1155,389.2344 L1155,414.2344 L1372,414.2344 L1372,399.2344 L1362,389.2344 L1155,389.2344" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1362,389.2344 L1362,399.2344 L1372,399.2344 L1362,389.2344" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="165.3564" x="1176.7866" y="406.3013">&#1040;&#1089;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1085;&#1072;&#1103; &#1086;&#1073;&#1088;&#1072;&#1073;&#1086;&#1090;&#1082;&#1072;</text><g class="message" data-participant-1="MQ" data-participant-2="Worker"><polygon fill="#000000" points="1313.2852,436.5,1323.2852,440.5,1313.2852,444.5,1317.2852,440.5" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="1203.1631" x2="1319.2852" y1="440.5" y2="440.5"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="98.1221" x="1210.1631" y="435.4341">process_assets</text></g><g class="message" data-participant-1="Worker" data-participant-2="Worker"><line style="stroke:#000000;stroke-width:1;" x1="1325.2852" x2="1367.2852" y1="469.6328" y2="469.6328"/><line style="stroke:#000000;stroke-width:1;" x1="1367.2852" x2="1367.2852" y1="469.6328" y2="482.6328"/><line style="stroke:#000000;stroke-width:1;" x1="1326.2852" x2="1367.2852" y1="482.6328" y2="482.6328"/><polygon fill="#000000" points="1336.2852,478.6328,1326.2852,482.6328,1336.2852,486.6328,1332.2852,482.6328" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="214.1763" x="1332.2852" y="464.5669">attach_media, precompute_hints</text></g><g class="message" data-participant-1="Worker" data-participant-2="DB"><polygon fill="#000000" points="1088.2993,507.7656,1078.2993,511.7656,1088.2993,515.7656,1084.2993,511.7656" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="1082.2993" x2="1324.2852" y1="511.7656" y2="511.7656"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="173.0752" x="1094.2993" y="506.6997">update_quiz_status(ready)</text></g><!--SRC=[NPB1RjD048Rl-nH3JecQAgL77v1Q5KMH4ZLf4j5RjDX3icfYExlhee2GIb4v8O740o3U80L51Aguhp1-8sPZ9yASxDt_dvcTR-Q9dU0C8PvA5Gghx1I1ljAADhJARcYPVQHrzXde3_sWDVsY9LJD8lJX0AJxreI8fRRALx4CBLJe6wNqa7rYPyeHo-oMK_6vmdOObhqly2KCMxdIAaidtHOqfSNNSh7L-Lmsd6j_WiPgQIETEvfbmmLQhV0QS_NY-Q0ijziTwAE-LZvk3Nmk6xgHiMED_Lvxgv-TbkM1D5VGIp39mpkz_rgBz5LHElyLOWY7pxXFZnbzfvzxmEli9lj0l-7f4J2lb1xvBitUEtf0ZvG2UnzeoTeABYjYs79f68S7tVF-01eoLervejuqV8qCJ3Xopj7q8ByPENMaSPumBo5Ecavc7Xxe0b7LdyZOeeRBcc013eluLrgEPnXQKmGn8m_66ABUfQt6Efh5zc3lh0a7TfTWMpcMYsaaWrtbirCFZEIYMt66LWRIobgXTdeUO3XtNAinQgECpTylZK6NFk-l87byT0nlBKzYf89wNaq5xuG88uiGyUmvNptdxm5zOQfhscHtZZ3Jt_1sycAdTE_sdEuP-osl-L9qUkufkpXkqKTZYXU8_FfVWxHM-XDk9L2opdRqcKd2X2OgB0MurfCusC_4M6aJK-Kf1OkQ-0i0]--></g></svg>